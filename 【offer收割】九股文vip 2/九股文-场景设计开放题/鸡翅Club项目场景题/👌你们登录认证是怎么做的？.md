# 你是如何对接公众号登录的？
对接公众号主要是希望用某新的唯一的 openId，来作为唯一的标识，也方便用户的登录。<br />整体流程主要是用户扫公众号码。然后发一条消息：验证码。我们通过 api 回复一个随机的码。存入 redis<br />redis 的主要结构，就是 openId 加验证码。用户在验证码框输入之后，点击登录，进入我们的注册模块，同时关联角色和权限。就实现了网关的统一鉴权。用户就可以进行操作，用户可以根据个人的 openId 来维护个人信息。用户登录成功之后，返回 token，前端的所有请求都带着 token 就可以访问。<br />从服务涉及上，我们开一个新服务，专门用于对接某信的 api 和微信的消息的回调。
# 你是如何监听用户发给公众号的消息的？
主要是对接公众号的回调消息平台配置。重点主要分为三步：填写服务器配置，验证服务器地址的有效性，依据接口文档实现业务逻辑。<br />在公众号配置界面填写服务器地址（URL）、Token和EncodingAESKey，其中URL是开发者用来接收微信消息和事件的接口URL。Token可由开发者可以任意填写，用作生成签名（该Token会和接口URL中包含的Token进行比对，从而验证安全性）。EncodingAESKey由开发者手动填写或随机生成，将用作消息体加解密密钥。<br />验证消息的确来自微信服务器：某信服务器将发送GET请求到填写的服务器地址URL上，GET请求携带参数有签名，内容，时间戳之类的，后台服务要通过一样的加密形式来进行校验。<br />依据接口文档实现业务逻辑：验证URL有效性成功后即接入生效，用户每次向公众号发送消息，开发者填写的服务器配置URL将得到微信服务器推送过来的消息和事件，开发者可以依据自身业务逻辑进行响应，如回复消息。
# 回调消息的验证校验是如何做的？
开发者通过检验signature对请求进行校验。若确认此次GET请求来自微信服务器，请原样返回echostr参数内容，则接入生效，成为开发者成功，否则接入失败。加密/校验流程如下：<br />1）将token、timestamp、nonce三个参数进行字典序排序<br />2）将三个参数字符串拼接成一个字符串进行sha1加密<br />3）开发者获得加密后的字符串可与signature对比，标识该请求来源于微信
