redis内部使用文件事件处理器 file event handler，它是单线程的，所以redis才叫做单线程模型。它采用IO多路复用机制同时监听多个 socket，将产生事件的 socket 压入内存队列中，事件分派器根据 socket 上的事件类型来选择对应的事件处理器进行处理。
#### 1. I/O多路复用
Redis采用I/O多路复用技术来处理多个客户端的连接。I/O多路复用允许单个线程同时监视多个文件描述符（即客户端连接）。当某个文件描述符准备好执行I/O操作时，操作系统会通知Redis，Redis然后处理这个文件描述符上的请求。<br />Redis支持多种I/O多路复用库，包括：

- select
- poll
- epoll（Linux）
- kqueue（BSD）
- evport（Solaris）

在启动时，Redis会自动选择最优的I/O多路复用机制。
#### 3. 事件循环
Redis的事件驱动模型基于一个事件循环（event loop）。事件循环负责监控所有的文件描述符，并在有事件发生时调用相应的事件处理器。事件循环主要包括以下几个步骤：

1. **事件检测**：使用I/O多路复用机制检测哪些文件描述符有事件发生。
2. **事件分派**：将发生事件的文件描述符分派给相应的事件处理器。
3. **事件处理**：调用事件处理器处理具体的事件，如读写数据、处理命令等。
#### 4. 客户端请求处理
当客户端发送请求到Redis时，以下是处理流程：

1. **接收请求**：Redis通过I/O多路复用机制检测到客户端的写事件，并将请求数据读入内存。
2. **解析命令**：Redis解析客户端发送的命令。
3. **执行命令**：根据解析的命令执行相应的操作，如读写数据、修改数据结构等。
4. **返回结果**：将命令执行结果通过I/O多路复用机制发送回客户端。
#### 5. 异步任务
虽然Redis的核心是单线程的，但它也会使用后台线程来处理一些异步任务，例如：

- **AOF重写**：为了防止AOF文件过大，Redis会在后台进行AOF重写。
- **RDB快照**：生成RDB快照的过程也是在后台进行的。
- **删除过期键**：Redis会定期检查并删除过期的键，这个过程也可以在后台线程中进行。
#### 6. 多线程 I/O（Redis 6.0+）
从Redis 6.0开始，引入了多线程 I/O 模型，用于处理网络 I/O 操作。虽然命令执行仍然是单线程的，但网络 I/O 操作可以由多个线程处理，从而提高了在高并发场景下的吞吐量。<br />在redis.conf文件中，可以配置多线程 I/O：
```
io-threads-do-reads yes
io-thread
```
