Redis通过维护一个内部的过期字典来判断数据是否过期。每个键值对在创建或更新时，可以选择设置一个过期时间。当键的过期时间到达时，Redis会将其标记为过期并在适当的时机删除。具体使用了以下几种策略来判断和处理过期数据：
### 1. 定期检查
Redis会定期随机抽取一些设置了过期时间的键，检查它们是否已经过期。这个过程是由一个独立的线程每秒钟执行几次的。

- **定期任务**：Redis内部有一个定期任务，每秒钟执行10次。每次任务会随机检查20个设置了过期时间的键。
- **过期处理**：如果发现键已经过期，则删除该键。如果在一次检查中发现超过25%的键已经过期，则继续进行更多的检查，直到过期键的比例低于25%。

这种方法保证了大部分过期键能够及时被删除，但由于是随机抽样，某些过期键可能会在一段时间内没有被及时删除。
### 2. 惰性删除
当客户端访问一个键时，Redis会检查该键是否已经过期。如果已经过期，Redis会立即删除该键，并返回键不存在的结果。

- **访问检查**：每当客户端尝试访问某个键时，Redis会检查该键的过期时间。如果过期，则删除该键并返回nil。
- **写操作检查**：类似地，当对某个键进行写操作（如更新、删除）时，Redis也会检查该键是否已经过期。

这种方法确保了在访问过期键时能够及时删除该键，但对于长时间不访问的过期键，依赖于定期检查来处理。
### 3. 内存淘汰
当Redis的内存使用达到配置的maxmemory限制时，会根据配置的内存淘汰策略（如LRU、LFU、TTL）删除一些键，包括过期键。

- **内存限制**：如果内存使用超过了maxmemory限制，Redis会触发内存淘汰机制。
- **淘汰策略**：Redis会根据配置的策略选择删除一些键，包括过期键，以释放内存。

这种方法在内存紧张时能够有效地清理过期键，避免内存溢出。
### 过期时间的存储
Redis将每个键的过期时间存储在一个独立的过期字典中。过期字典中的每个条目包含一个键和对应的过期时间（以毫秒为单位）。当键被删除或更新时，其过期时间也会被相应地删除或更新。
### 过期键的删除
过期键的删除是一个惰性操作，过期键不会立即被删除，在访问或内存淘汰时被删除。
