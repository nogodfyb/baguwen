ISR 和 AR 是与 Kafka 分区副本管理相关的两个概念。
### ISR（In-Sync Replicas）
ISR 是指与领导者副本保持同步的一组副本。这些副本包含了与领导者副本相同的数据，并且能够在领导者副本发生故障时迅速接替成为新的领导者。

- **成员**：ISR 集合中的所有副本都是同步副本。
- **同步条件**：一个副本被认为是同步的，如果它在一定时间内（由参数replica.lag.time.max.ms控制）没有落后于领导者副本超过一定的滞后量（由参数replica.lag.max.messages控制）。
- **作用**：ISR 集合用于确保数据的高可用性和一致性。如果领导者副本崩溃，ISR 集合中的一个副本会被选为新的领导者。
### AR（Assigned Replicas）
AR 是指为一个分区分配的所有副本。它包括领导者副本和所有跟随者副本。

- **成员**：AR 集合中的所有副本都是该分区的副本，无论它们是否与领导者副本同步。
- **作用**：AR 集合用于描述一个分区的所有副本，包括那些可能暂时不同步的副本。
### 关系与区别

- **包含关系**：ISR 是 AR 的子集。也就是说，ISR 集合中的副本都是 AR 集合中的一部分，但 AR 集合中的副本不一定都在 ISR 集合中。
- **同步状态**：ISR 中的副本是与领导者副本同步的，而 AR 中的副本可能包括不同步的副本。
### 示例
假设一个 Kafka 分区有三个副本，分别是副本 0、1 和 2。副本 0 是领导者副本，副本 1 和 2 是跟随者副本。

- 如果副本 1 和 2 都与副本 0 同步，那么 ISR 集合为 {0, 1, 2}。
- 如果副本 2 落后于副本 0 超过了允许的滞后时间或滞后消息数，副本 2 将从 ISR 集合中移除，此时 ISR 集合为 {0, 1}。
### 配置参数

- replica.lag.time.max.ms：一个跟随者副本落后于领导者副本的最大时间，超过这个时间将被认为不同步。
- replica.lag.max.messages：一个跟随者副本落后于领导者副本的最大消息数，超过这个数量将被认为不同步。
### 总结

- **ISR（In-Sync Replicas）**：与领导者副本保持同步的一组副本，确保数据的高可用性和一致性。
- **AR（Assigned Replicas）**：为一个分区分配的所有副本，包括领导者副本和所有跟随者副本。
